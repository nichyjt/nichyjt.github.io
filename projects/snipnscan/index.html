<!doctype html><html lang=en-sg><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><title>SnipNScan | Nicholas Yek üßá</title><meta name=description content="A winter break project to scan QR codes and text on desktop. Borne out of pdf pain and exasperation with people sending me images to debug code (please stop doing that)."><link rel=canonical href=https://nichyjt.github.io/projects/snipnscan/><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/mainmenu.css><link rel=stylesheet href=/css/fonts.css><link rel=stylesheet href=/css/colours.css><link rel=stylesheet href=/css/pagenav.css><link rel=stylesheet href=/css/homepage.css><link rel=stylesheet href=/css/featured.css><link rel=stylesheet href=/css/shortcodes.css><meta property="og:title" content="SnipNScan"><meta property="og:description" content="A winter break project to scan QR codes and text on desktop. Borne out of pdf pain and exasperation with people sending me images to debug code (please stop doing that)."><meta property="og:type" content="article"><meta property="og:url" content="https://nichyjt.github.io/projects/snipnscan/"><meta property="article:section" content="projects"><meta property="article:published_time" content="2022-02-26T00:00:00+00:00"><meta property="article:modified_time" content="2022-02-26T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="SnipNScan"><meta name=twitter:description content="A winter break project to scan QR codes and text on desktop. Borne out of pdf pain and exasperation with people sending me images to debug code (please stop doing that)."><script>localStorage.getItem("theme")||localStorage.setItem("theme","lightmode")</script></head><body><div class=navcontainer><body><nav class=navbar><div class=home-item><a href=https://nichyjt.github.io class=home-link><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="home" class="svg-inline--fa fa-home fa-w-18" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M280.37 148.26 96 300.11V464a16 16 0 0016 16l112.06-.29a16 16 0 0015.92-16V368a16 16 0 0116-16h64a16 16 0 0116 16v95.64a16 16 0 0016 16.05L464 480a16 16 0 0016-16V3e2L295.67 148.26a12.19 12.19.0 00-15.3.0zM571.6 251.47 488 182.56V44.05a12 12 0 00-12-12h-56a12 12 0 00-12 12v72.61L318.47 43a48 48 0 00-61 0L4.34 251.47a12 12 0 00-1.6 16.9l25.5 31A12 12 0 0045.15 301l235.22-193.74a12.19 12.19.0 0115.3.0L530.9 301a12 12 0 0016.9-1.6l25.5-31a12 12 0 00-1.7-16.93z"/></svg><span class=home-text>HOME</span></a></div><ul class=navbar-large><li class=nav-item><button style="cursor:pointer;padding:0;border:none;background:0 0" , class=menu-item>
<a href=/about , class=menu-item><svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="address-card" class="svg-inline--fa fa-address-card fa-w-18" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M528 32H48C21.5 32 0 53.5.0 80v352c0 26.5 21.5 48 48 48h480c26.5.0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm0 4e2H48V80h480v352zM208 256c35.3.0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm-89.6 128h179.2c12.4.0 22.4-8.6 22.4-19.2v-19.2c0-31.8-30.1-57.6-67.2-57.6-10.8.0-18.7 8-44.8 8-26.9.0-33.4-8-44.8-8-37.1.0-67.2 25.8-67.2 57.6v19.2c0 10.6 10 19.2 22.4 19.2zM360 320h112c4.4.0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H360c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8zm0-64h112c4.4.0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H360c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8zm0-64h112c4.4.0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H360c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8z"></path></svg><span class=menu-item-text>ABOUT</span></a></button></li><li class=nav-item><button style="cursor:pointer;padding:0;border:none;background:0 0" , class=menu-item>
<a href=/essays , class=menu-item><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="pen" class="svg-inline--fa fa-pen fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06-60.11-60.11c-18.75-18.75-49.16-18.75-67.91.0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16.0-67.91z"></path></svg><span class=menu-item-text>ESSAYS</span></a></button></li><li class=nav-item><button style="cursor:pointer;padding:0;border:none;background:0 0" , class=menu-item>
<a href=/projects , class=menu-item><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="robot" class="svg-inline--fa fa-robot fa-w-20" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentcolor" d="M32 224H64V416H32A31.96166 31.96166.0 010 384V256a31.96166 31.96166.0 0132-32zm512-48V448a64.06328 64.06328.0 01-64 64H160a64.06328 64.06328.0 01-64-64V176a79.974 79.974.0 0180-80H288V32a32 32 0 0164 0V96H464a79.974 79.974.0 0180 80zM264 256a40 40 0 10-40 40 39.997 39.997.0 0040-40zm-8 128H192v32h64zm96 0H288v32h64zM456 256a40 40 0 10-40 40 39.997 39.997.0 0040-40zm-8 128H384v32h64zM640 256V384a31.96166 31.96166.0 01-32 32H576V224h32a31.96166 31.96166.0 0132 32z"></path></svg><span class=menu-item-text>PROJECTS</span></a></button></li><li class=nav-item><button style="cursor:pointer;padding:0;border:none;background:0 0" , class=menu-item>
<a href=/tags , class=menu-item><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tags" class="svg-inline--fa fa-tags fa-w-20" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentcolor" d="M497.941 225.941 286.059 14.059A48 48 0 00252.118.0H48C21.49.0.0 21.49.0 48v204.118a48 48 0 0014.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882.0l204.118-204.118c18.745-18.745 18.745-49.137.0-67.882zM112 160c-26.51.0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882.0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397.0h48.721a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882z"></path></svg><span class=menu-item-text>TAGS</span></a></button></li><li class=nav-item><button id=darkmode-toggle , style="cursor:pointer;padding:0;border:none;background:0 0" , class=menu-item , onclick=changetheme()>
<a class=menu-item , style=text-decoration:underline><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="adjust" class="svg-inline--fa fa-adjust fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705.0 184 82.311 184 184 0 101.705-82.311 184-184 184z"></path></svg><span class=menu-item-text>DARKMODE</span></a></button>
<script>function changetheme(){document.body.className.includes("darkmode")?(document.body.classList.replace("darkmode","lightmode"),localStorage.setItem("theme","lightmode")):(document.body.classList.replace("lightmode","darkmode"),localStorage.setItem("theme","darkmode")),document.activeElement.blur()}</script></li></ul><div class=navbar-mobile><button class=hamburg-btn><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" class="svg-inline--fa fa-bars fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M16 132h416c8.837.0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163.0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837.0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837.0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837.0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837.0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></svg></button><ul class=navbar-hamburg-items><li class=nav-item><button style="cursor:pointer;padding:0;border:none;background:0 0" , class=menu-item>
<a href=/about , class=menu-item><svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="address-card" class="svg-inline--fa fa-address-card fa-w-18" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M528 32H48C21.5 32 0 53.5.0 80v352c0 26.5 21.5 48 48 48h480c26.5.0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm0 4e2H48V80h480v352zM208 256c35.3.0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm-89.6 128h179.2c12.4.0 22.4-8.6 22.4-19.2v-19.2c0-31.8-30.1-57.6-67.2-57.6-10.8.0-18.7 8-44.8 8-26.9.0-33.4-8-44.8-8-37.1.0-67.2 25.8-67.2 57.6v19.2c0 10.6 10 19.2 22.4 19.2zM360 320h112c4.4.0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H360c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8zm0-64h112c4.4.0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H360c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8zm0-64h112c4.4.0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H360c-4.4.0-8 3.6-8 8v16c0 4.4 3.6 8 8 8z"></path></svg><span class=menu-item-text>ABOUT</span></a></button></li><li class=nav-item><button style="cursor:pointer;padding:0;border:none;background:0 0" , class=menu-item>
<a href=/essays , class=menu-item><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="pen" class="svg-inline--fa fa-pen fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06-60.11-60.11c-18.75-18.75-49.16-18.75-67.91.0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16.0-67.91z"></path></svg><span class=menu-item-text>ESSAYS</span></a></button></li><li class=nav-item><button style="cursor:pointer;padding:0;border:none;background:0 0" , class=menu-item>
<a href=/projects , class=menu-item><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="robot" class="svg-inline--fa fa-robot fa-w-20" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentcolor" d="M32 224H64V416H32A31.96166 31.96166.0 010 384V256a31.96166 31.96166.0 0132-32zm512-48V448a64.06328 64.06328.0 01-64 64H160a64.06328 64.06328.0 01-64-64V176a79.974 79.974.0 0180-80H288V32a32 32 0 0164 0V96H464a79.974 79.974.0 0180 80zM264 256a40 40 0 10-40 40 39.997 39.997.0 0040-40zm-8 128H192v32h64zm96 0H288v32h64zM456 256a40 40 0 10-40 40 39.997 39.997.0 0040-40zm-8 128H384v32h64zM640 256V384a31.96166 31.96166.0 01-32 32H576V224h32a31.96166 31.96166.0 0132 32z"></path></svg><span class=menu-item-text>PROJECTS</span></a></button></li><li class=nav-item><button style="cursor:pointer;padding:0;border:none;background:0 0" , class=menu-item>
<a href=/tags , class=menu-item><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tags" class="svg-inline--fa fa-tags fa-w-20" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentcolor" d="M497.941 225.941 286.059 14.059A48 48 0 00252.118.0H48C21.49.0.0 21.49.0 48v204.118a48 48 0 0014.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882.0l204.118-204.118c18.745-18.745 18.745-49.137.0-67.882zM112 160c-26.51.0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882.0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397.0h48.721a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882z"></path></svg><span class=menu-item-text>TAGS</span></a></button></li><li class=nav-item><button id=darkmode-toggle , style="cursor:pointer;padding:0;border:none;background:0 0" , class=menu-item , onclick=changetheme()>
<a class=menu-item , style=text-decoration:underline><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="adjust" class="svg-inline--fa fa-adjust fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705.0 184 82.311 184 184 0 101.705-82.311 184-184 184z"></path></svg><span class=menu-item-text>DARKMODE</span></a></button>
<script>function changetheme(){document.body.className.includes("darkmode")?(document.body.classList.replace("darkmode","lightmode"),localStorage.setItem("theme","lightmode")):(document.body.classList.replace("lightmode","darkmode"),localStorage.setItem("theme","darkmode")),document.activeElement.blur()}</script></li></ul></div></nav></body></div><div class=bodycontainer><main><section class=section><div class=frontmatter><h1 class="title, listTitleLink">SnipNScan</h1><div class=subtitle><p><time>üìÜ February 26, 2022</time>
| ‚åõ 7 minutes read</p></div><p class=tags>üìã Tags: <a style=color:var(--color-link);margin-inline:.2rem href=https://nichyjt.github.io/tags/c/c++>C/C++</a> <a style=color:var(--color-link);margin-inline:.2rem href=https://nichyjt.github.io/tags/opencv>OpenCV</a> <a style=color:var(--color-link);margin-inline:.2rem href=https://nichyjt.github.io/tags/linux>Linux</a></p></div><hr><div class=content><h1 id=image-hell>Image Hell</h1><blockquote><p>A picture is worth a thousand words - A common adage</p></blockquote><p>Images are a rich source of information. But what worth is that thousand words if I can&rsquo;t extract the actual text inside the images? Let me explain my frustration about images.</p><h3 id=webinar-link-hell>Webinar Link Hell</h3><p>Imagine yourself in some online conference. Stare in wonder as the presenter asks you to access some (long-ass) link on their screen share. Extra points if the presenter does not drop the link into chat - good luck typing it into your browser before they move on!</p><blockquote><p><em>Try typing this in 30s</em><br><a href="https://www.a_very_long_foobar_link.com/123409%25~A875&sYm-b0ls?ref=LMAO-GOODLUCK-TYPING-THIS-IN-30-SECONDS?&12#-90">www.a_very_long_foobar_link.com/123409%~A875&sYm-b0ls?ref=LMAO-GOODLUCK-TYPING-THIS-IN-30-SECONDS?&12#-90</a></p></blockquote><h3 id=how-not-to-ask-for-code-help>How not to ask for code help</h3><p>Sometimes I get questions from friends asking for help with their code. Instead of sending me text, I get an image instead.</p><figure class=figmd><img src=/images/snipnscan/Original_lightcode.png alt="Actual image from a friend - truncated for brevity"><figcaption><p>Actual image from a friend - truncated for brevity</p></figcaption></figure><h3 id=images-of-text-why>Images of text (Why?!)</h3><p>One thing that frustrates me is that certain research papers and lecture slides format text as images. Some of these texts are meant to be copy-pasted, such as boilerplate lab code for a tutorial or some DOI link.</p><p>It is simply a waste of time to manually type out references and long-ass code.</p><h3 id=extra-qr-tasks-id-rather-do-on-desktop>Extra: QR tasks I&rsquo;d rather do on desktop</h3><p>As an added bonus frustration, some QR codes link to very text-heavy surveys or websites not optimised for mobile (NUS class attendance login page, I&rsquo;m looking at you üò§). I&rsquo;d rather do these using my PC, but the issue is that there&rsquo;s no native way<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> to scan QR codes on desktop!</p><h1 id=a-solution>A Solution</h1><p>The frustrations that I faced above can be solved if I built a desktop tool to scan QR codes and scan text in images. Kind of like the snipping tool but for optical character recognition (OCR).</p><p>So I built a <a href=https://github.com/nichyjt/SnipNScan>GUI-based Linux tool</a> over the 2021 winter break to do just that. Its FOSS too (licenseed under AGPL-3); you are more than welcome to mess with my code.</p><h2 id=dependencies>Dependencies</h2><p>This mini project depends on OpenCV, Tesseract and zbar for the backend logic and OCR, and wxWidgets for UI.</p><h1 id=snipnscan>SnipNScan</h1><p>This section is for the nerds. It is basically me recounting what I learnt and how I approached the preprocessing of images for OCR scanning. If you&rsquo;re here in the capacity of a non-technical onlooker, perhaps the results section below will be of more interest to you!</p><h2 id=application-control-flow>Application Control Flow</h2><p>For reference, this is the simplified user control flow for this app:</p><ol><li><p>Take a snapshot of your screen</p></li><li><p>Drag over the area of the snapshot you want to scan</p></li><li><p>Magic happens with OCR @ the backend</p></li><li><p>You get the text/QR code link from the scanned area</p></li><li><p>Profit</p></li></ol><h2 id=preprocessing-images-step-3>Preprocessing Images (Step 3)</h2><p>After taking a screenshot and cropping it, we will need to preprocess the image for our OCR engine to scan.</p><p>I am not a data scientist nor am I experienced in OpenCV - so the implementation of pre-processing is in the capacity of a hobbyist which is likely to be iffy.</p><p>The end-goal here is to perform OCR. So, we will want to remove any redundant colors and noise from the image that we want to scan. This can be done through grayscaling, denoising and thresholding.</p><h2 id=grayscaling>Grayscaling</h2><figure class=figmd><img src=/images/snipnscan/Grayscaled_lightcode.png alt="Grayscaled Image"><figcaption><p>Grayscaled Image</p></figcaption></figure><p>Why is there a need to grayscale? Most functions in OpenCV only work for Grayscaled images. Also, we are reducing the amount of information needed to do operations on. Instead of 3 channels (Red Blue Green), we only deal with one (Grayscale).</p><h2 id=denoising-and-adaptive-thresholding>Denoising and Adaptive Thresholding</h2><p>Denoising helps to reduce unwanted pixels from the snapshot after grayscaling. It will make the OCR work better.</p><p>Adaptive Thresholding is a whole different beast. Based on the surrounding areas, it determines if the region should be set to 0 or 1 (dark or light). There&rsquo;s also some fine-tuning that can be done with a constant.</p><p>Compared to simple thresholding that sets every pixel based on a threshold value, adaptive thresholding generalises better to different lighting conditions.</p><figure class=figmd><img src=/images/snipnscan/process_lightcode.png alt="Thresholding the denoised, grayscaled image"><figcaption><p>Thresholding the denoised, grayscaled image</p></figcaption></figure><h2 id=dark-mode-pain>Dark Mode Pain</h2><p>After testing the pre-processing with some image of code (using lightmode&mldr;) that a friend sent me, I was quite satisfied with the results &ndash; it was pretty accurate! But then I hopped over to Stack Overflow with dark mode on and realised that <em>everything broke</em>.</p><p>Dark mode broke stuff. After some investigation and testing I realised that the constant added to the <code>adaptiveThreshold</code> function caused the preprocessed image to behave very <strong>very</strong> wonkily.</p><figure class=figmd><img src=/images/snipnscan/Original.darkblog.png alt="Using dark theme images from my blog (Original)"><figcaption><p>Using dark theme images from my blog (Original)</p></figcaption></figure><figure class=figmd><img src=/images/snipnscan/process_darkblog_badC.png alt="Thresholding with badly chosen (lightmode) constant"><figcaption><p>Thresholding with badly chosen (lightmode) constant</p></figcaption></figure><h3 id=a-lazy-workaround>A lazy workaround</h3><p>The thresholding constant, c for lightmode is positive (<code>c = 26</code>). Through some testing I realised that negative values of c, (s.a. <code>c=-42</code>) work better for dark background/themed images.</p><figure class=figmd><img src=/images/snipnscan/process_darkblog.png alt="Thresholding with appropriate constant (much better&amp;hellip;)"><figcaption><p>Thresholding with appropriate constant (much better&mldr;)</p></figcaption></figure><p>The question is - how to determine programatically if an image is dark/light mode?</p><p><strong>The Lazy Fix</strong>: find out the most dominant shade of grey and determine from there if the image is light or dark themed from there.</p><p>The idea is to use OpenCV&rsquo;s histogram function to determine the spread of colors on the grayscaled image. Plotting the histogram using OpenCV clearly shows a distinction between the spread between light and dark images.</p><p>Issues seeing the graphs? Try using darkmode on this blog to view the histograms properly. (This is my problem, sorry!)</p><p>NOTE: The horizontal axis represents how <strong>light</strong> the shade is. The further right, the lighter the shade.</p><figure class=figmd><img src=/images/snipnscan/hist.lightblog.png alt="Histogram of a light theme"><figcaption><p>Histogram of a light theme</p></figcaption></figure><figure class=figmd><img src=/images/snipnscan/hist.darkblog.png alt="Histogram of a dark theme"><figcaption><p>Histogram of a dark theme</p></figcaption></figure><figure class=figmd><img src=/images/snipnscan/hist_ling.png alt="Histogram of a particularly noisy, light image (Ling&amp;rsquo;s cars)"><figcaption><p>Histogram of a particularly noisy, light image (Ling&rsquo;s cars)</p></figcaption></figure><p>It&rsquo;s quite clear to see that for light themes, the mode lies beyond the middle of the scale to the most extreme right. For dark themes, it lies around the start to the middle.</p><p>So, the solution is simple and lazy<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. Decide the threshold between dark and light themes to be exactly in the middle of the horizontal axis.</p><div class=highlight><div style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868"> 0
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#6ab825;font-weight:700>bool</span> <span style=color:#447fcf>isDominantDark</span>(...){
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic>// Histogram logic omitted for brevity
</span></span></span><span style=display:flex><span><span style=color:#999;font-style:italic>// Trivial O(n) find max value
</span></span></span><span style=display:flex><span><span style=color:#999;font-style:italic></span>    <span style=color:#6ab825;font-weight:700>int</span> intensity = <span style=color:#3677a9>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>int</span> dominantBin = <span style=color:#3677a9>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>for</span>(<span style=color:#6ab825;font-weight:700>int</span> i=<span style=color:#3677a9>0</span>; i&lt;bins; ++i){
</span></span><span style=display:flex><span>        <span style=color:#999;font-style:italic>// Loop through the histogram hist to find the highest intensity
</span></span></span><span style=display:flex><span><span style=color:#999;font-style:italic></span>        <span style=color:#6ab825;font-weight:700>float</span> binVal = hist.at&lt;<span style=color:#6ab825;font-weight:700>float</span>&gt;(i);
</span></span><span style=display:flex><span>        <span style=color:#999;font-style:italic>// maxval was initialised earlier in histogram logic
</span></span></span><span style=display:flex><span><span style=color:#999;font-style:italic></span>        <span style=color:#6ab825;font-weight:700>int</span> relFreq = cvRound(binVal*hist_height/max_val);
</span></span><span style=display:flex><span>        <span style=color:#6ab825;font-weight:700>if</span>(relFreq &gt; intensity){
</span></span><span style=display:flex><span>            intensity = relFreq;
</span></span><span style=display:flex><span>            dominantBin = i;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#999;font-style:italic>// Greedy solution: Take midpt of intensity values as the binary trigger for dark/light mode
</span></span></span><span style=display:flex><span><span style=color:#999;font-style:italic></span>    <span style=color:#6ab825;font-weight:700>return</span> (dominantBin &lt; (<span style=color:#3677a9>256</span>/<span style=color:#3677a9>2</span>));
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Now, to apply the appropriate constant is simply calling the <code>isDominantDark</code> function and assigning from there.</p><div class=highlight><div style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868">0
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#686868">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#6ab825;font-weight:700>int</span> c = <span style=color:#3677a9>26</span>;
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>if</span>(isDominantDark(grayed)){
</span></span><span style=display:flex><span>    c = -<span style=color:#3677a9>42</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h1 id=results>Results</h1><p>The end result was quite satisfactory to me. OCR results were quite accurate & the QR code scanning function worked perfectly out of the box for <code>zbar</code> and <code>opencv</code>.</p><h2 id=lightmode>Lightmode</h2><figure class=figmd><img src=/images/snipnscan/snipscan_lightcode.png></figure><p>Output:</p><blockquote><pre tabindex=0><code>def get_date_today():
return (2013, 18, 30)

class Artist(object):
def _init_ (self, name, dob):
# Fill in your code here
self.name = name
self.dob = dob
</code></pre></blockquote><h2 id=darkmode>Darkmode</h2><figure class=figmd><img src=/images/snipnscan/snipscan_darkblog.png></figure><p>Output:</p><blockquote><p><code>Cnake ~ Recreating the classic Snake game with C, ncurses and Linked Lists. ta 6/8/2021 | ¬• 5 min read @ Tags: C/C++ Linux Data Structures</code></p></blockquote><h1 id=conclusion-lings-cars>Conclusion: Ling&rsquo;s Cars</h1><p>Just for fun &ndash; I wanted to test out my utility over very noisy environments to test how well the application works/generalises in the wild. Why not test it out on one of my favourite websites, <a href=https://www.lingscars.com/>LingsCars.com</a>? If you wonder why I chose this website, I impore you to click the link. It&rsquo;s a work of art üëå</p><p>This is the noisy image I want to scan.<figure class=figmd><img src=/images/snipnscan/Original_ling.png alt=Colourful!><figcaption><p>Colourful!</p></figcaption></figure></p><p>This is how the pre-processing turned out:</p><figure class=figmd><img src=/images/snipnscan/processed_ling.png alt="Still quite noisy&amp;hellip;"><figcaption><p>Still quite noisy&mldr;</p></figcaption></figure><p>And what was returned by the OCR:</p><blockquote><p><code>UNAS AS Gomme 4 Leader of the Pack - The UK's favorite car leasing website! Contract hire cars, LINGSCARS is the "UK's favourite car leasing website" - On 2016 We leaseu over 85 million in cars! (RRP)</code></p></blockquote><p>The important bits (to me) were scanned correctly. All in all a win!</p><p>This project was quite fun but a bit of a hassle at times because I was coding OpenCV with C++. Perhaps my next OpenCV project (if I ever do another one) will be in Python.</p><p>This project was a useful endeavour and self-made software I actually use actively compared to my other projects such as <a href=https://nichyjt.github.io/projects/cnake/>my Cnake game</a>. The only limitations so far with this project is compiling to windows, and friends sending me <strong>videos</strong> of their code to debug. But that&rsquo;s a writeup for another time!</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>At least in my experience with Ubuntu and Windows. I&rsquo;m not too sure about MacOS and other distros.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>It is lazy because it follows the heuristic that there are only 2 distinct possibilities for c. It does not account for the possibility that the image can be dominantly &lsquo;grey&rsquo; &ndash; where neither the postive nor negative values of c are the best option for the adaptive threshold.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></div></section></main></div><footer class=footer><div><p class=footertext style=color:#f0f8ff;font-family:MainTitle;align-self:center>Powered by
<a href=https://gohugo.io/ target=_blank style=color:var(--color-link)><span>Hugo</span></a></p></div><div class=footertext style=font-family:MainTitle;align-self:center><a href=https://nichyjt.github.io/attributions/ style=color:var(--color-link)><span>Attributions & üç™</span></a></div><div><p class=footertext class=footertext style=color:#f0f8ff;font-family:MainTitle;align-items:center>Made with ‚ù§Ô∏è - <a href=https://github.com/nichyjt/ target=_blank , style=color:var(--color-link)>nichyjt</a></p></div><div class=footertext style=color:#f0f8ff;font-family:MainTitle;align-self:center>¬© 2021 - 2022 Nicholas Yek</div><div class=fontloader></div></footer></body><script>document.body.classList.add(localStorage.getItem("theme"))</script></html>